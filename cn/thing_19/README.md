# 便利不是一种特性

对于设计好的 API 的重要性和挑战已经被广泛讨论过了。第一次设计就很难做到完美，后续进行修改更加困难。就像抚养孩子一样。大多数有经验的程序员都明白，一个好的 API 需要保持一致的抽象层次、表现出一致性和对称性，并形成一种表达能力强的语言。然而，了解这些指导原则并不自动转化为适当的行为。吃甜食对身体有害。

我不想空谈理论，我想指出一个特定的 API 设计“策略”，这是我一次又一次遇到的：便利性的论点。它通常始于以下几种“洞察”之一：

- 我不想让其他类必须调用两次才能完成这个操作。

- 如果另一个方法与这个方法几乎相同，为什么我要再写一个方法呢？我只需添加一个简单的开关。

- 看，很简单：如果第二个字符串参数以“.txt”结尾，那么该方法自动假设第一个参数是文件名，所以我真的不需要两个方法。

虽然这样的论点出发点是好的，但很可能会降低使用该 API 的代码的可读性。像下面这样的方法调用：

```
parser.processNodes(text, false);
```

如果不知道实现细节或者至少查看文档，它几乎没有意义。这个方法很可能是为了实现者的便利而设计的，而不是为了调用者的便利——“我不希望调用者必须进行两次调用”转化为“我不想编写两个分开的方法”。如果我们仔细考虑一下，便利性并没有什么本质上的问题，如果它是为了解决繁琐、笨拙或者尴尬而存在的。然而，如果我们更加仔细地思考，我们就会发现，解决这些问题的办法是效率、一致性和优雅，而不仅仅是便利性。API 应该隐藏底层复杂性，因此我们可以合理地期望良好的 API 设计需要一些努力。一个单独的大方法肯定比经过深思熟虑的一组操作更容易编写，但使用起来会更容易吗？

将 API 视为一种语言的隐喻可以指导我们在这些情况下做出更好的设计决策。API 应该提供一种表达能力强的语言，为上一层次提供足够的词汇来提出和回答有用的问题。这并不意味着它应该为可能值得提问的每个问题提供一种方法或动词。多样的词汇允许我们表达意义上的微妙之处。例如，我们更倾向于使用“run”而不是“walk(true)”，尽管可以将它视为本质上相同的操作，只是以不同的速度执行。一种一致且经过深思熟虑的 API 词汇使得上一层次的代码具有表达能力且易于理解。更重要的是，一个可组合的词汇允许其他程序员以您可能未曾预料到的方式使用 API——这对于 API 的用户来说确实是一个很大的便利！下次当你想把一些东西合并成一个 API 方法时，记住英语中没有一个词可以表示“MakeUpYourRoomBeQuietAndDoYourHomeWork”，尽管这对于这种经常请求的操作来说似乎非常方便。

由[Gregor Hohpe](http://programmer.97things.oreilly.com/wiki/index.php/Gregor_Hohpe)撰写
