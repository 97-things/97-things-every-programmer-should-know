# 警惕代码共享

这是我在公司的第一个项目。我刚刚完成学位，渴望证明自己，每天都加班研究现有的代码。在处理我的第一个功能时，我特别小心地应用了我所学到的一切——注释、日志记录，将共享代码提取到可能的库中，全都做到了。然而，我准备好接受的代码审查却给我带来了不愉快的领悟——重用被视为不好的做法！

这怎么可能？在整个大学期间，重用一直被视为高质量软件工程的典范。我阅读的所有文章、教科书以及教导我的经验丰富的软件专业人士都是这么说的。难道都错了吗？

事实证明，我漏掉了一个关键点。

上下文。

事实上，系统中两个完全不同的部分以相同的方式执行某些逻辑，意义并不像我想的那么大。在我将这些共享代码库提取出来之前，这些部分彼此之间并不依赖。每个部分可以独立发展。每个部分可以根据系统不断变化的业务环境调整其逻辑。这四行相似的代码只是偶然的——一个时间上的异常，一个巧合。直到我出现在这里。

我创建的共享代码库将每个部分的脚趾带在一起。一个业务领域的步骤无法在与其他领域同步之前进行。在这些独立函数中的维护成本以前是微不足道的，但共享库需要更多的测试。

虽然我减少了系统中的代码行数，但我增加了依赖关系的数量。这些依赖关系的上下文至关重要——如果它们是局部的，那可能是合理的并且有一定的积极价值。当这些依赖关系没有受到控制时，它们的触角将缠绕系统的更大问题，尽管代码本身看起来很好。

这些错误很阴险，因为从根本上来说，它们听起来是个好主意。在正确的上下文中应用这些技术是有价值的。在错误的上下文中，它们增加了成本而不是价值。当我进入一个没有对各个部分将被使用的上下文了解的现有代码库时，我现在对代码共享要更加谨慎。

警惕代码共享。审查上下文。只有在这之后，才可以继续前进。

由[Udi Dahan](http://programmer.97things.oreilly.com/wiki/index.php/Udi_Dahan)撰写
